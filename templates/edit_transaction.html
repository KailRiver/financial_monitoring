{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Редактировать транзакцию #{{ transaction.id }}</h2>
    
    {% if transaction.status in non_editable_statuses %}
    <div class="alert alert-warning mt-3">
        Редактирование запрещено для транзакций со статусом "{{ transaction.status }}"
    </div>
    {% else %}
    <form method="POST" class="mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="entity_type">Тип лица</label>
                    <select name="entity_type" id="entity_type" class="form-control" required>
                        <option value="Физическое лицо" {% if transaction.entity_type == 'Физическое лицо' %}selected{% endif %}>
                            Физическое лицо
                        </option>
                        <option value="Юридическое лицо" {% if transaction.entity_type == 'Юридическое лицо' %}selected{% endif %}>
                            Юридическое лицо
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="operation_date">Дата операции</label>
                    <input type="date" name="operation_date" id="operation_date" 
                           value="{{ transaction.operation_date }}" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="transaction_type">Тип транзакции</label>
                    <select name="transaction_type" id="transaction_type" class="form-control" required>
                        <option value="Поступление" {% if transaction.transaction_type == 'Поступление' %}selected{% endif %}>
                            Поступление
                        </option>
                        <option value="Списание" {% if transaction.transaction_type == 'Списание' %}selected{% endif %}>
                            Списание
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="amount">Сумма</label>
                    <input type="number" step="0.00001" name="amount" id="amount" 
                           value="{{ transaction.amount }}" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="status">Статус операции</label>
                    <select name="status" id="status" class="form-control" required>
                        {% for status in status_choices %}
                            <option value="{{ status }}" {% if transaction.status == status %}selected{% endif %}>
                                {{ status }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="form-group">
                    <label for="sender_bank">Банк отправителя</label>
                    <input type="text" name="sender_bank" id="sender_bank" 
                           value="{{ transaction.sender_bank or '' }}" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="account">Счет</label>
                    <input type="text" name="account" id="account" 
                           value="{{ transaction.account or '' }}" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="recipient_bank">Банк получателя</label>
                    <input type="text" name="recipient_bank" id="recipient_bank" 
                           value="{{ transaction.recipient_bank or '' }}" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="recipient_inn">ИНН получателя</label>
                    <input type="text" name="recipient_inn" id="recipient_inn" 
                           value="{{ transaction.recipient_inn or '' }}" class="form-control" 
                           pattern="\d{11}" title="ИНН должен содержать 11 цифр">
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="recipient_account">Счет получателя</label>
                    <input type="text" name="recipient_account" id="recipient_account" 
                           value="{{ transaction.recipient_account or '' }}" class="form-control">
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="form-group">
                    <label for="category">Категория</label>
                    <input type="text" name="category" id="category" 
                           value="{{ transaction.category or '' }}" class="form-control">
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="recipient_phone">Телефон получателя</label>
                    <input type="tel" name="recipient_phone" id="recipient_phone" 
                           value="{{ transaction.recipient_phone or '' }}" class="form-control" 
                           pattern="^(\+7|8)\d{10}$" title="Формат: +79998887766 или 89998887766">
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="form-group">
                    <label for="comment">Комментарий</label>
                    <textarea name="comment" id="comment" class="form-control" rows="2">{{ transaction.comment or '' }}</textarea>
                </div>
            </div>
        </div>
        
        <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="{{ url_for('transactions') }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
    {% endif %}
</div>
{% endblock %}